// |===================================|
// |  EasyISP â€” Simple ISP Multiplier 
// |
// |  Scale engine ISP via the `atmosphereCurve` values
// |  Applies to all parts with ModuleEngines|ModuleEnginesFX
// |
// |===================================|
// |
// |  Adjust the ispMultiplier value in the area below
// |  Save the file and start KSP
// |
// |===================================|

EASYISP_SETTINGS
{
  ispMultiplier = 2  // <- Change this number to scale Isp for all engines
}

// |===================================|
// |  1.0 = stock ISP
// |  2.0 = double ISP
// |  0.5 = half ISP
// |  1000 = "The Expanse"ish
// |===================================|

// EasyISP is intended to be a global ISP multiplier that applies after all other engine balance mods.
// To ensure the multiplier is applied last, this patch runs in :FINAL.
@PART[*]:HAS[@MODULE[ModuleEngines*]]:FINAL
{
  @MODULE[ModuleEngines*],*
  {
    @atmosphereCurve
    {
      // Pull multiplier from the global settings node.
      mult = #$@EASYISP_SETTINGS/ispMultiplier$

      // Multiply the ISP for every key in the curve.
      @key,*[1, ] *= #$mult$
    }
  }
}

// B9PartSwitch stores subtype engine config under SUBTYPE/MODULE/DATA.
// Scale stored atmosphereCurve values so subtype switching keeps EasyISP multiplier.
@PART[*]:HAS[@MODULE[ModuleB9PartSwitch]]:NEEDS[B9PartSwitch]:FINAL
{
  @MODULE[ModuleB9PartSwitch],*
  {
    @SUBTYPE,*
    {
      @MODULE,*
      {
        @DATA,*:HAS[@atmosphereCurve]
        {
          @atmosphereCurve
          {
            // Pull multiplier from the same global settings node.
            mult = #$@EASYISP_SETTINGS/ispMultiplier$

            // Multiply the ISP for every key in the curve.
            @key,*[1, ] *= #$mult$
          }
        }
      }
    }
  }
}
